---
import { Button, FormInput, FormTextarea } from '@components/odyssey-theme';
import settings from '../../config/settings.js';
---


<form id="contact-form" name="Contact Form" method="POST" action={`https://formsubmit.tailofleaves.dev/submit/${settings.email}`}>
  <FormInput type="hidden" name="FormName" value="Joshi Jam Contact Form"></FormInput>
  <FormInput type="text" label="Name" name="Name" placeholder="Roy Mustang" />
  <FormInput type="email" label="Email" name="Email" placeholder="flame@alchemist.com" />
  <FormTextarea label="Message" name="Message" placeholder="Your message here..." />
  <Button id="submit-btn" type="submit">Submit</Button>
  <div id="form-message" class="form-message"></div>
</form>

<script type="module">
  const form = document.getElementById('contact-form');
  const submitBtn = document.getElementById('submit-btn');
  const messageDiv = document.getElementById('form-message');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    submitBtn.disabled = true;
    messageDiv.textContent = '';
    messageDiv.className = 'form-message';
    const formData = new FormData(form);
    try {
      const response = await fetch(form.action, {
        method: 'POST',
        body: formData,
        headers: { 'Accept': 'application/json' }
      });
      if (response.ok) {
        messageDiv.innerHTML = 'Thank you! Your message has been sent.';
        messageDiv.classList.add('success');
        form.reset();
      } else {
        messageDiv.innerHTML = `Sorry, there was an error sending your message.<br>Please send us an email instead at <a href="mailto:${settings.email}">${settings.email}</a>`;
        messageDiv.classList.add('error');
      }
    } catch (err) {
      messageDiv.innerHTML = `Sorry, there was an error sending your message.<br>Please send us an email instead at <a href="mailto:${settings.email}">${settings.email}</a>`;
      messageDiv.classList.add('error');
    } finally {
      submitBtn.disabled = false;
    }
  });
</script>

<style>
  form {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  .form-message {
    min-height: 1.5em;
    margin-top: 0.5em;
    font-size: 1rem;
    text-align: center;
    transition: color 0.2s;
  }
  .form-message.success {
    color: #2e7d32;
  }
  .form-message.error {
    color: #c62828;
  }
</style>